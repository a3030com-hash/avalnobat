{% extends "booking/base.html" %}

{% block title %}تایید کد{% endblock %}

{% block content %}
<div class="form-container">
    <h2>تایید شماره موبایل</h2>
    <p>کد ۶ رقمی ارسال شده به شماره {{ mobile_number }} را وارد کنید.</p>

    {% if error %}
        <p class="error-list">{{ error }}</p>
    {% endif %}

    <form method="post" action="{% url 'booking:verify_patient_login' %}" id="verify-form">
        {% csrf_token %}
        <div class="form-group">
            <label for="otp">کد تایید</label>
            <input type="text" id="otp" name="otp" required pattern="\d{6}" title="کد تایید باید ۶ رقمی باشد." autocomplete="one-time-code">
        </div>
        <button type="submit" class="btn-submit btn-block">تایید و ورود</button>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
    if ('OTPCredential' in window) {
        window.addEventListener('DOMContentLoaded', e => {
            const input = document.querySelector('input[autocomplete="one-time-code"]');
            if (!input) return;

            const ac = new AbortController();
            navigator.credentials.get({
                otp: { transport: ['sms'] },
                signal: ac.signal
            }).then(otp => {
                if (otp) {
                    input.value = otp.code; // کد OTP به فیلد ورودی اختصاص می‌یابد
                }
            }).catch(err => {
                console.log(err);
            });
        });
    } else {
        // اگر 'OTPCredential' در مرورگر پشتیبانی نشود، می‌توانید از این کد برای نمایش پیام استفاده کنید.
        console.log("خدمات OTP در این مرورگر پشتیبانی نمی‌شود.");
    }
</script>
{% endblock %}