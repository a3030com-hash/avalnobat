{% extends 'booking/base.html' %}
{% load booking_filters %}

{% block title %}{{ page_title }} - AvalNobat{% endblock %}

{% block content %}
<div class="panel-container" id="daily-patients-container">
    {# The initial content is loaded by the view #}
    {% include 'booking/daily_patients_content.html' %}
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('submit', function(e) {
        const container = document.getElementById('daily-patients-container');
        if (!container || !e.target.closest('#daily-patients-form')) return;

        e.preventDefault();
        const form = e.target;
        const formData = new FormData(form);

        fetch(form.action, {
            method: 'POST',
            body: formData,
            headers: { 'X-Requested-With': 'XMLHttpRequest' }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                //alert('تغییرات با موفقیت ذخیره شد.');
                // The global date navigation script will handle the refresh
                const currentDate = new Date(localStorage.getItem('userDate'));
                window.updateContentForDate(currentDate, false);
            } else {
                console.error('Validation Error:', data.errors);
                alert('خطا در ذخیره اطلاعات. جزئیات در کنسول ثبت شده است.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while saving.');
        });
    });
</script>
{% endblock %}
