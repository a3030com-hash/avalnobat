{% extends 'booking/base.html' %}

{% block title %}{{ page_title }} - AvalNobat{% endblock %}

{% block meta_tags %}
<meta name="description" content="لیست بهترین پزشکان متخصص در پلتفرم اول نوبت. به راحتی پزشک مورد نظر خود را بر اساس تخصص، نام یا منطقه پیدا کرده و نوبت خود را آنلاین رزرو کنید.">
{% endblock %}

{% block content %}
<style>
    .doctor-card {
        background-color: white;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        display: flex;
        gap: 1.5rem;
        align-items: center;
    }
    .doctor-photo {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid #f0f0f0;
    }
    .doctor-info {
        flex: 1;
    }
    .doctor-info h2 {
        margin-top: 0;
        font-size: 1.5rem;
    }
    .doctor-info h2 a {
        text-decoration: none;
        color: #007bff;
    }
    .doctor-info p {
        color: #6c757d;
        margin: 0.5rem 0;
    }
    .doctor-info .icon {
        margin-left: 8px;
        color: #868e96;
    }
</style>

<style>
    .search-container {
        background-color: #f8f9fa;
        padding: 2rem;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        margin-bottom: 2rem;
    }
    .search-form {
        display: flex;
        gap: 1rem;
        align-items: center;
        position: relative;
    }
    .clear-search {
        position: absolute;
        left: 120px;
        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
        color: #aaa;
        display: none; /* Hidden by default */
    }
    .search-form input, .search-form select {
        padding: 0.75rem;
        border: 1px solid #ced4da;
        border-radius: 5px;
        font-size: 1rem;
        flex: 1;
    }
    .search-btn {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1rem;
    }
</style>

<div class="d-flex justify-content-between align-items-center">
    <h2 class="elegant-title">{{ page_title }}</h2>
    <a href="{% url 'booking:patient_login' %}" class="btn btn-secondary">ورود / ثبت نام بیمار</a>
</div>

<div class="search-container">
    <form method="get" action="{% url 'booking:doctor_list' %}" class="search-form" id="search-form">
        <input type="text" name="q" id="main-search-input" placeholder="جستجو تخصص/نام پزشک/ منطقه" value="{{ request.GET.q }}" style="text-align: right;">
        <i class="fas fa-times clear-search"  id="clear-search-icon"></i>
        <button type="submit" class="search-btn">جستجو</button>
    </form>
</div>

<hr style="margin-bottom: 2rem;">

{% if doctors %}
    {% for doctor in doctors %}
        <div class="doctor-card">
            <div class="doctor-photo-container">
                {% if doctor.photo %}
                    <img src="{{ doctor.photo.url }}" alt="عکس دکتر {{ doctor.user.get_full_name }}" class="doctor-photo">
                {% else %}
                    <!-- Placeholder image -->
                    <img src="https://via.placeholder.com/100" alt="عکس موجود نیست" class="doctor-photo">
                {% endif %}
            </div>
            <div class="doctor-info">
                <h2>
                    <a href="{% url 'booking:doctor_detail' pk=doctor.pk %}">
                        دکتر {{ doctor.user.get_full_name }}
                    </a>
                </h2>
                <p><i class="fas fa-stethoscope icon"></i><strong>تخصص:</strong> {{ doctor.specialty.name|default:"-" }}</p>
                <p><i class="fas fa-map-marker-alt icon"></i><strong>آدرس:</strong> {{ doctor.address|truncatewords:10 }}</p>
                {% if doctor.has_availability %}
                <div style="margin-top: 1rem; margin-bottom: 1rem;">
                    <a href="{% url 'booking:doctor_detail' pk=doctor.pk %}" style="background-color: #007bff; color: white; padding: 10px 20px; text-decoration: none; border-radius: 20px; display: inline-block;">
                        دریافت نوبت اینترنتی
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    {% endfor %}
{% else %}
    <p>در حال حاضر پزشکی برای نمایش وجود ندارد.</p>
{% endif %}

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('main-search-input');
        const clearIcon = document.getElementById('clear-search-icon');
        const searchForm = document.getElementById('search-form');

        function toggleClearIcon() {
            if (searchInput.value) {
                clearIcon.style.display = 'block';
            } else {
                clearIcon.style.display = 'none';
            }
        }

        // Initial check in case the page is loaded with a search query
        toggleClearIcon();

        searchInput.addEventListener('input', toggleClearIcon);

        clearIcon.addEventListener('click', function() {
            searchInput.value = '';
            toggleClearIcon();
            searchForm.submit();
        });
    });
</script>
{% endblock %}