{% extends 'booking/base.html' %}
{% load booking_filters %}

{% block title %}{{ page_title }} - AvalNobat{% endblock %}

{% block content %}
<div class="expense-container" id="secretary-payments-container">
    {% include 'booking/secretary_payments_content.html' %}
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('submit', function(e) {
        const container = document.getElementById('secretary-payments-container');
        if (!container || !e.target.closest('#expense-form')) return;

        e.preventDefault();
        const form = e.target;
        const formData = new FormData(form);

        fetch(form.action, {
            method: 'POST',
            body: formData,
            headers: { 'X-Requested-With': 'XMLHttpRequest' }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const currentDate = new Date(localStorage.getItem('userDate'));
                window.updateContentForDate(currentDate, false);
            } else {
                 alert('خطا در ثبت اطلاعات. لطفاً ورودی‌ها را بررسی کنید.');
            }
        })
        .catch(error => console.error('Error:', error));
    });
</script>
{% endblock %}
