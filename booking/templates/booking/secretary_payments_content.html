{% load booking_filters %}

<h1>{{ page_title }}</h1>
<p><strong>تاریخ:</strong> {{ today|to_jalali:"%A, %d %B %Y" }}</p>
<hr>

<div class="split-layout">
    <div class="form-container">
        <h3>ثبت هزینه/پرداخت جدید</h3>
        <form id="expense-form" method="post" action="{% url 'booking:secretary_payments' date=today|date:'Y-m-d' %}">
            {% csrf_token %}
            {{ expense_form.as_p }}
            <h6>وجه نقدی دریافتی از پزشک را منفی وارد کنید</h6>
            <button type="submit" class="btn-submit">ثبت</button>
        </form>
    </div>
    <div class="expense-list-container">
        <h3>لیست هزینه‌ها و پرداخت‌های امروز</h3>
        <table id="expenses-table" class="report-table">
            <thead>
                <tr>
                    <th>شرح</th>
                    <th>مبلغ (به تومان)</th>
                    <th>عملیات</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td data-label="شرح">مانده صندوق از روز قبل</td>
                    <td data-label="مبلغ (به تومان)">{{ previous_day_balance|intcomma }}</td>
                    <td data-label="عملیات"></td>
                </tr>
                <tr>
                    <td data-label="شرح">اضافه میشود ویزیت های نقدی امروز</td>
                    <td data-label="مبلغ (به تومان)">{{ todays_cash_income|intcomma }}</td>
                    <td data-label="عملیات"></td>
                </tr>
                <tr>
                    <td data-label="شرح">کسر میشود هزینه و پرداختهای امروز:</td>
                    <td data-label="مبلغ (به تومان)"></td>
                    <td data-label="عملیات"></td>
                </tr>
                {% for expense in daily_expenses %}
                <tr>
                    <td data-label="شرح">{{ expense.description }}</td>
                    <td data-label="مبلغ (به تومان)" class="amount {% if expense.amount > 0 %}positive{% else %}negative{% endif %}">
                        {{ expense.amount|intcomma }}
                    </td>
                    <td data-label="عملیات">
                        <a href="{% url 'booking:edit_expense' pk=expense.pk %}" class="btn btn-sm btn-info">ویرایش</a>
                        <a href="{% url 'booking:delete_expense' pk=expense.pk %}" class="btn btn-sm btn-danger">حذف</a>
                    </td>
                </tr>
                {% empty %}
                <tr id="no-expense-row">
                    <td colspan="3">موردی برای نمایش وجود ندارد.</td>
                </tr>
                {% endfor %}
                <tr>
                    <td data-label="شرح">مانده صندوق</td>
                    <td data-label="مبلغ (به تومان)">{{ cash_box_balance|intcomma }}</td>
                    <td data-label="عملیات"></td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
