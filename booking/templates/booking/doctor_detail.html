{% extends 'booking/base.html' %}
{% load booking_filters %}

{% block title %}{{ page_title }} - AvalNobat{% endblock %}

{% block meta_tags %}
<meta name="description" content="اطلاعات و نوبت‌دهی آنلاین دکتر {{ doctor.user.get_full_name }}، متخصص {{ doctor.specialty.name }}. {{ doctor.biography|truncatewords:20 }}">
{% endblock %}

{% block content %}
<style>
    .profile-container {
        background-color: white;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 2rem;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .profile-container .doctor-photo {
        max-width: 150px;
        border-radius: 50%;
        margin-bottom: 1rem;
        border: 3px solid #fff;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .calendar {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 10px;
        margin-top: 20px;
    }
    .day {
        padding: 15px;
        border: 1px solid #ddd;
        text-align: center;
        border-radius: 8px;
        font-weight: bold;
    }
    .day.available {
        background: linear-gradient(to left, #f8d7da 0%, #f8d7da var(--booked-percentage, 0%), #d4edda var(--booked-percentage, 0%), #d4edda 100%);
        color: #155724;
        cursor: pointer;
        transition: transform 0.2s;
    }
    .day.available:hover {
        transform: scale(1.05);
    }
    .day.full {
        background-color: #f8d7da;
        color: #721c24;
        opacity: 0.7;
    }
    .day.unavailable {
        background-color: #e9ecef;
        color: #6c757d;
    }
    .day-empty {
        border: 1px solid #f8f9fa;
        background-color: #f8f9fa;
    }
    .day-name {
        font-weight: bold;
        text-align: center;
        padding: 10px;
        color: #6c757d;
    }
    .legend {
        margin-top: 15px;
        display: flex;
        justify-content: center;
        gap: 20px;
        font-size: 14px;
    }
    .legend span {
        display: flex;
        align-items: center;
    }
    .legend .color-box {
        width: 15px;
        height: 15px;
        margin-left: 5px;
        border-radius: 3px;
    }
</style>

<div class="profile-container">
    <h2 class="elegant-title">{{ page_title }}</h2>
    {% if doctor.photo %}
        <img src="{{ doctor.photo.url }}" alt="عکس دکتر {{ doctor.user.get_full_name }}" class="doctor-photo">
    {% endif %}
    <p><strong>نام کامل:</strong> دکتر {{ doctor.user.get_full_name }}</p>
    <p><strong>تخصص:</strong> {{ doctor.specialty.name|default:"-" }}</p>
    <p><strong>شماره تلفن مطب:</strong> {{ doctor.phone_number }}</p>
    <p><strong>آدرس:</strong> {{ doctor.address }}</p>
    {% if average_rating %}
        <p><strong>میانگین امتیاز:</strong> {{ average_rating|floatformat:1 }} ستاره</p>
    {% endif %}
    <p><strong>بیوگرافی:</strong></p>
    <p>{{ doctor.biography|linebreaks|default:"بیوگرافی ثبت نشده است." }}</p>

    <hr>




    <h3>تقویم نوبت‌دهی ({{ doctor.booking_days }} روز آینده)</h3>
    <div  class="calendar-grid" style="display: flex; flex-wrap: wrap; gap: 10px;">
        {% for day in available_days %}
            <a href="{% url 'booking:book_appointment' pk=doctor.pk date=day.date|to_jalali:'%Y-%m-%d' %}" class="day-cell available" style="background: linear-gradient(to top, #f8d7da {{ day.booked_percentage }}%, white {{ day.booked_percentage }}%); border: 2px solid #007bff; border-radius: 5px; padding: 20px; text-align: center; flex: 1 1 150px; min-width: 150px;"> <!-- استفاده از flex برای تنظیم اندازه باکس -->
                {{ day.date|to_jalali:"%d %B" }} ({{ day.jalali_day_name }})
            </a>
        {% empty %}
            <p>در {{ doctor.booking_days }} روز آینده نوبت خالی وجود ندارد.</p>
        {% endfor %}
    </div>
</div>
{% endblock %}