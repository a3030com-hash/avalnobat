{% extends 'booking/base.html' %}
{% load booking_filters %}

{% block title %}{{ page_title }} - AvalNobat{% endblock %}

{% block meta_tags %}
<meta name="description" content="اطلاعات و نوبت‌دهی آنلاین دکتر {{ doctor.user.get_full_name }}، متخصص {{ doctor.specialty.name }}. {{ doctor.biography|truncatewords:20 }}">
{% endblock %}

{% block content %}
<style>
    .profile-container {
        background-color: white;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 2rem;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .profile-container .doctor-photo {
        max-width: 100px;
        border-radius: 50%;
        margin-bottom: 1rem;
        border: 3px solid #fff;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .doctor-photo {
    max-width: 200px; /* یا اندازه دلخواه */
    border-radius: 50%; /* اگر می‌خواهید دایره‌ای باشد */
    margin-bottom: 10px;
}
    .star-rating {
        color: #f8d64e; /* Gold color for stars */
        margin-bottom: 0.5rem;
        font-size: 1.2rem;
    }
    .calendar {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 10px;
        margin-top: 20px;
    }
    .day {
        padding: 15px;
        border: 1px solid #ddd;
        text-align: center;
        border-radius: 8px;
        font-weight: bold;
    }
    .day.available {
        background: linear-gradient(to left, #f8d7da 0%, #f8d7da var(--booked-percentage, 0%), #d4edda var(--booked-percentage, 0%), #d4edda 100%);
        color: #155724;
        cursor: pointer;
        transition: transform 0.2s;
    }
    .day.available:hover {
        transform: scale(1.05);
    }
    .day.full {
        background-color: #f8d7da;
        color: #721c24;
        opacity: 0.7;
    }
    .day.unavailable {
        background-color: #e9ecef;
        color: #6c757d;
    }
    .day-empty {
        border: 1px solid #f8f9fa;
        background-color: #f8f9fa;
    }
    .day-name {
        font-weight: bold;
        text-align: center;
        padding: 10px;
        color: #6c757d;
    }
    .legend {
        margin-top: 15px;
        display: flex;
        justify-content: center;
        gap: 20px;
        font-size: 14px;
    }
    .legend span {
        display: flex;
        align-items: center;
    }
    .legend .color-box {
        width: 15px;
        height: 15px;
        margin-left: 5px;
        border-radius: 3px;
    }

    /* Two-column layout for desktop */
    @media (min-width: 992px) {
        .profile-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
        }
       .profile-sidebar {
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    text-align: center !important;
    gap: 5px !important;
    }
    .doctor-name-container {
    text-align: center;
    margin: 1rem 0;
}

.doctor-name {
    font-family: 'Vazir', 'IRANSans', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    font-size: 1.2rem;
    font-weight: 700;
    color: #d82995;
    margin-bottom: 0.5rem;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
}

 }
</style>

<div class="profile-container">
    <div style="position: relative;">
        <h2 class="elegant-title">{{ page_title }}</h2>
        <a href="{% url 'booking:doctor_list' %}" class="home-icon-link" title="صفحه اصلی">
            <i class="fas fa-home"></i>
        </a>
    </div>
    <div class="profile-grid">
        <div  class="profile-sidebar">
            {% if doctor.photo %}
                <img src="{{ doctor.photo.url }}" alt="عکس دکتر {{ doctor.user.get_full_name }}" class="doctor-photo">
            {% endif %}
               <div class="doctor-name-container">
        <h1 class="doctor-name">دکتر {{ doctor.user.get_full_name }}</h1>
       
    </div>
            <p><strong>تخصص:</strong> {{ doctor.specialty.name|default:"-" }}</p>
            {% if average_rating %}
                <div class="star-rating">
                    {% with rating_floor=average_rating|floor %}
                    {% for i in "12345" %}
                        {% if forloop.counter <= rating_floor %}
                            <i class="fas fa-star"></i>
                        {% else %}
                            {% if forloop.counter == rating_floor|add:1 and average_rating > rating_floor %}
                                <i class="fas fa-star-half-alt"></i>
                            {% else %}
                                <i class="far fa-star"></i>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                    {% endwith %}
                    ({{ average_rating|floatformat:1 }})
                </div>
            {% endif %}
        </div>
        <div class="profile-main">
            <p><strong>شماره تلفن مطب:</strong> {{ doctor.phone_number }}</p>
            <p><strong>آدرس:</strong> {{ doctor.address }}</p>
            <p><strong>بیوگرافی:</strong></p>
            <p>{{ doctor.biography|linebreaks|default:"بیوگرافی ثبت نشده است." }}</p>

          
        </div>
    </div>
      <hr>

            <h3>تقویم نوبت‌دهی ({{ doctor.booking_days }} روز آینده)</h3>
            <div  class="calendar-grid" style="display: flex; flex-wrap: wrap; gap: 10px;">
                {% for day in available_days %}
                    <a href="{% url 'booking:book_appointment' pk=doctor.pk date=day.date|to_jalali:'%Y-%m-%d' %}" class="day-cell available" style="background: linear-gradient(to top, #f8d7da {{ day.booked_percentage }}%, white {{ day.booked_percentage }}%); border: 2px solid #007bff; border-radius: 5px; padding: 20px; text-align: center; flex: 1 1 150px; min-width: 150px;"> <!-- استفاده از flex برای تنظیم اندازه باکس -->
                        {{ day.date|to_jalali:"%d %B" }} ({{ day.jalali_day_name }})
                    </a>
                {% empty %}
                    <p>در {{ doctor.booking_days }} روز آینده نوبت خالی وجود ندارد.</p>
                {% endfor %}
            </div>
</div>
{% endblock %}